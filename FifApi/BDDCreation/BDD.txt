
commit;
drop table if exists "__EFMigrationsHistory" cascade;
drop table if exists "joueurMatch" cascade;
drop table if exists Joueur cascade;
drop table if exists Match cascade;
drop table if exists Poste cascade;
drop table if exists Produit cascade;
drop table if exists Marque cascade;
drop table if exists Couleur cascade;
drop table if exists "CouleurProduit" cascade;
drop table if exists Taille cascade;
drop table if exists Stock cascade;




CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE couleur (
    idcouleur int GENERATED BY DEFAULT AS IDENTITY,
    nomproduit varchar(150) NOT NULL,
    CONSTRAINT "PK_couleur" PRIMARY KEY (idcouleur)
);

CREATE TABLE marque (
    idmarque int GENERATED BY DEFAULT AS IDENTITY,
    nommarque varchar(200) NOT NULL,
    CONSTRAINT "PK_marque" PRIMARY KEY (idmarque)
);

CREATE TABLE match (
    idmatch int GENERATED BY DEFAULT AS IDENTITY,
    scoreequipedomicile int NOT NULL,
    scoreequipeexterieure int NOT NULL,
    nommatch Varchar(50) NOT NULL,
    datematch Date NOT NULL,
    CONSTRAINT "PK_match" PRIMARY KEY (idmatch)
);

CREATE TABLE poste (
    idposte int GENERATED BY DEFAULT AS IDENTITY,
    nomposte Varchar(150) NOT NULL,
    descriptionposte Varchar(300) NOT NULL,
    CONSTRAINT "PK_poste" PRIMARY KEY (idposte)
);

CREATE TABLE taille (
    idtaille char(6) NOT NULL,
    nomtaille Varchar(50) NOT NULL,
    descriptiontaille Varchar(100) NOT NULL,
    CONSTRAINT "PK_taille" PRIMARY KEY (idtaille)
);

CREATE TABLE "typeProduit" (
    idtype int GENERATED BY DEFAULT AS IDENTITY,
    nomtype varchar(100) NOT NULL,
    descriptiontype varchar(150) NOT NULL,
    soustypeid int NOT NULL,
    CONSTRAINT pk_joueur PRIMARY KEY (idtype),
    CONSTRAINT fk_joueur_poste FOREIGN KEY (soustypeid) REFERENCES "typeProduit" (idtype)
);

CREATE TABLE joueur (
    idjoueur int GENERATED BY DEFAULT AS IDENTITY,
    nomjoueur Varchar(150) NOT NULL,
    prenomjoueur Varchar(150) NOT NULL,
    sexejoueur Char(1) NOT NULL,
    datenaissancejoueur Date NOT NULL,
    datedecesjoueur Date NOT NULL,
    debutcarrierejoueur Date NOT NULL,
    fincarrierejoueur Date NOT NULL,
    descriptionjoueur Varchar(1000) NOT NULL,
    posteid int NOT NULL,
    CONSTRAINT pk_joueur PRIMARY KEY (idjoueur),
    CONSTRAINT fk_joueur_poste FOREIGN KEY (posteid) REFERENCES poste (idposte)
);

CREATE TABLE produit (
    idproduit int GENERATED BY DEFAULT AS IDENTITY,
    nomproduit varchar(150) NOT NULL,
    descriptionproduit varchar(1000) NOT NULL,
    caracteristiquesproduit varchar(500) NOT NULL,
    marqueid int NOT NULL,
    typeid int NOT NULL,
    CONSTRAINT pk_produit PRIMARY KEY (idproduit),
    CONSTRAINT fk_produit_marque FOREIGN KEY (marqueid) REFERENCES marque (idmarque),
    CONSTRAINT "fk_produit_Type" FOREIGN KEY (typeid) REFERENCES "typeProduit" (idtype)
);

CREATE TABLE "joueurMatch" (
    joueurid int NOT NULL,
    matchid int NOT NULL,
    nbbuts int NOT NULL,
    CONSTRAINT "pk_joueurMatch" PRIMARY KEY (matchid, joueurid),
    CONSTRAINT "fk_joueurMatch_joueur" FOREIGN KEY (joueurid) REFERENCES joueur (idjoueur),
    CONSTRAINT "fk_joueurMatch_match" FOREIGN KEY (matchid) REFERENCES match (idmatch)
);

CREATE TABLE "CouleurProduit" (
    idcouleurproduit int GENERATED BY DEFAULT AS IDENTITY,
    prix numeric(8,2) NOT NULL,
    codebarre varchar(48) NOT NULL,
    produitid int NOT NULL,
    couleurid int NOT NULL,
    "MatchId" integer NOT NULL,
    CONSTRAINT "pk_couleurProduit" PRIMARY KEY (idcouleurproduit),
    CONSTRAINT "fk_couleurProduit_couleur" FOREIGN KEY (couleurid) REFERENCES couleur (idcouleur),
    CONSTRAINT "fk_couleurProduit_produit" FOREIGN KEY (produitid) REFERENCES produit (idproduit)
);

CREATE TABLE stock (
    tailleid char(6) NOT NULL,
    couleurproduitid int NOT NULL,
    quantite int NOT NULL,
    CONSTRAINT pk_stock PRIMARY KEY (tailleid, couleurproduitid),
    CONSTRAINT fk_stock_couleur FOREIGN KEY (couleurproduitid) REFERENCES "CouleurProduit" (idcouleurproduit),
    CONSTRAINT fk_stock_taille FOREIGN KEY (tailleid) REFERENCES taille (idtaille)
);

CREATE INDEX "IX_CouleurProduit_couleurid" ON "CouleurProduit" (couleurid);

CREATE INDEX "IX_CouleurProduit_produitid" ON "CouleurProduit" (produitid);

CREATE INDEX "IX_joueur_posteid" ON joueur (posteid);

CREATE INDEX "IX_joueurMatch_joueurid" ON "joueurMatch" (joueurid);

CREATE INDEX "IX_produit_marqueid" ON produit (marqueid);

CREATE INDEX "IX_produit_typeid" ON produit (typeid);

CREATE INDEX "IX_stock_couleurproduitid" ON stock (couleurproduitid);

CREATE INDEX "IX_typeProduit_soustypeid" ON "typeProduit" (soustypeid);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20240313090004_FifaBDD', '6.0.12');

COMMIT;
